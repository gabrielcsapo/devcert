"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
const fs_1 = require("fs");
const mkdirp_1 = require("mkdirp");
const lodash_1 = require("lodash");
const eol = require("eol");
const utils_1 = require("./utils");
const applicationConfigPath = require("application-config-path");
const _createDebug = require("debug");
const debug = _createDebug('devcert:constants');
// Platform shortcuts
exports.isMac = process.platform === 'darwin';
exports.isLinux = process.platform === 'linux';
exports.isWindows = process.platform === 'win32';
// Common paths
exports.configDir = applicationConfigPath('devcert');
exports.configPath = path.join.bind(path, exports.configDir);
exports.domainsDir = exports.configPath('domains');
exports.caVersionFile = exports.configPath('devcert-ca-version');
exports.opensslSerialFilePath = exports.configPath('certificate-authority', 'serial');
exports.opensslDatabaseFilePath = exports.configPath('certificate-authority', 'index.txt');
exports.caSelfSignConfig = path.join(__dirname, '../openssl-configurations/certificate-authority-self-signing.conf');
function includeWildcards(list) {
    return list.reduce((outlist, item) => {
        outlist.push(item, `*.${item}`);
        return outlist;
    }, []);
}
async function withDomainSigningRequestConfig(commonName, { alternativeNames }, cb) {
    const tmp = utils_1.tmpDir();
    const tmpFile = path.join(tmp.name, 'domain-certificate-signing-requests.conf');
    const source = fs_1.readFileSync(path.join(__dirname, '../openssl-configurations/domain-certificate-signing-requests.conf'), 'utf-8');
    const template = lodash_1.template(source);
    const result = template({
        commonName,
        altNames: includeWildcards([commonName, ...alternativeNames])
    });
    fs_1.writeFileSync(tmpFile, eol.auto(result));
    await cb(tmpFile);
    fs_1.unlinkSync(tmpFile);
    tmp.removeCallback();
}
exports.withDomainSigningRequestConfig = withDomainSigningRequestConfig;
async function withDomainCertificateConfig(commonName, alternativeNames, cb) {
    const tmp = utils_1.tmpDir();
    const tmpFile = path.join(tmp.name, 'ca.cfg');
    const source = fs_1.readFileSync(path.join(__dirname, '../openssl-configurations/domain-certificates.conf'), 'utf-8');
    const template = lodash_1.template(source);
    const result = template({
        commonName,
        altNames: includeWildcards([commonName, ...alternativeNames]),
        serialFile: exports.opensslSerialFilePath,
        databaseFile: exports.opensslDatabaseFilePath,
        domainDir: utils_1.pathForDomain(commonName)
    });
    fs_1.writeFileSync(tmpFile, eol.auto(result));
    await cb(tmpFile);
    fs_1.unlinkSync(tmpFile);
    tmp.removeCallback();
}
exports.withDomainCertificateConfig = withDomainCertificateConfig;
// confTemplate = confTemplate.replace(/DATABASE_PATH/, configPath('index.txt').replace(/\\/g, '\\\\'));
// confTemplate = confTemplate.replace(/SERIAL_PATH/, configPath('serial').replace(/\\/g, '\\\\'));
// confTemplate = eol.auto(confTemplate);
exports.rootCADir = exports.configPath('certificate-authority');
exports.rootCAKeyPath = path.join(exports.rootCADir, 'private-key.key');
exports.rootCACertPath = path.join(exports.rootCADir, 'certificate.cert');
debug('rootCACertPath', exports.rootCACertPath);
debug('rootCAKeyPath', exports.rootCAKeyPath);
debug('rootCADir', exports.rootCADir);
// Exposed for uninstallation purposes.
function getLegacyConfigDir() {
    if (exports.isWindows && process.env.LOCALAPPDATA) {
        return path.join(process.env.LOCALAPPDATA, 'devcert', 'config');
    }
    else {
        const uid = process.getuid && process.getuid();
        const userHome = exports.isLinux && uid === 0
            ? path.resolve('/usr/local/share')
            : require('os').homedir();
        return path.join(userHome, '.config', 'devcert');
    }
}
exports.getLegacyConfigDir = getLegacyConfigDir;
function ensureConfigDirs() {
    mkdirp_1.sync(exports.configDir);
    mkdirp_1.sync(exports.domainsDir);
    mkdirp_1.sync(exports.rootCADir);
}
exports.ensureConfigDirs = ensureConfigDirs;
ensureConfigDirs();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uc3RhbnRzLmpzIiwic291cmNlUm9vdCI6Ii4vIiwic291cmNlcyI6WyJjb25zdGFudHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2QkFBNkI7QUFDN0IsMkJBSVk7QUFDWixtQ0FBd0M7QUFDeEMsbUNBQWtEO0FBQ2xELDJCQUEyQjtBQUMzQixtQ0FBZ0Q7QUFDaEQsaUVBQWtFO0FBQ2xFLHNDQUFzQztBQUV0QyxNQUFNLEtBQUssR0FBRyxZQUFZLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUNoRCxxQkFBcUI7QUFDUixRQUFBLEtBQUssR0FBRyxPQUFPLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQztBQUN0QyxRQUFBLE9BQU8sR0FBRyxPQUFPLENBQUMsUUFBUSxLQUFLLE9BQU8sQ0FBQztBQUN2QyxRQUFBLFNBQVMsR0FBRyxPQUFPLENBQUMsUUFBUSxLQUFLLE9BQU8sQ0FBQztBQUV0RCxlQUFlO0FBQ0YsUUFBQSxTQUFTLEdBQUcscUJBQXFCLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDN0MsUUFBQSxVQUFVLEdBQTBDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUM3RSxJQUFJLEVBQ0osaUJBQVMsQ0FDVixDQUFDO0FBRVcsUUFBQSxVQUFVLEdBQUcsa0JBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUVuQyxRQUFBLGFBQWEsR0FBRyxrQkFBVSxDQUFDLG9CQUFvQixDQUFDLENBQUM7QUFDakQsUUFBQSxxQkFBcUIsR0FBRyxrQkFBVSxDQUM3Qyx1QkFBdUIsRUFDdkIsUUFBUSxDQUNULENBQUM7QUFDVyxRQUFBLHVCQUF1QixHQUFHLGtCQUFVLENBQy9DLHVCQUF1QixFQUN2QixXQUFXLENBQ1osQ0FBQztBQUNXLFFBQUEsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FDdkMsU0FBUyxFQUNULG1FQUFtRSxDQUNwRSxDQUFDO0FBRUYsU0FBUyxnQkFBZ0IsQ0FBQyxJQUFjO0lBQ3RDLE9BQU8sSUFBSSxDQUFDLE1BQU0s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QWEsQ0FBQyxDQUFDO0FBQ3RDLEtBQUssQ0FBQyxXQUFXLEVBQUUsaUJBQVMsQ0FBQyxDQUFDO0FBRTlCLHVDQUF1QztBQUN2QyxTQUFnQixrQkFBa0I7SUFDaEMsSUFBSSxpQkFBUyxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFO1FBQ3pDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxTQUFTLEVBQUUsUUFBUSxDQUFDLENBQUM7S0FDakU7U0FBTTtRQUNMLE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxNQUFNLElBQUksT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQy9DLE1BQU0sUUFBUSxHQUNaLGVBQU8sSUFBSSxHQUFHLEtBQUssQ0FBQztZQUNsQixDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQztZQUNsQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQzlCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0tBQ2xEO0FBQ0gsQ0FBQztBQVhELGdEQVdDO0FBRUQsU0FBZ0IsZ0JBQWdCO0lBQzlCLGFBQU0sQ0FBQyxpQkFBUyxDQUFDLENBQUM7SUFDbEIsYUFBTSxDQUFDLGtCQUFVLENBQUMsQ0FBQztJQUNuQixhQUFNLENBQUMsaUJBQVMsQ0FBQyxDQUFDO0FBQ3BCLENBQUM7QUFKRCw0Q0FJQztBQUVELGdCQUFnQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHtcbiAgd3JpdGVGaWxlU3luYyBhcyB3cml0ZUZpbGUsXG4gIHJlYWRGaWxlU3luYyBhcyByZWFkRmlsZSxcbiAgdW5saW5rU3luY1xufSBmcm9tICdmcyc7XG5pbXBvcnQgeyBzeW5jIGFzIG1rZGlycCB9IGZyb20gJ21rZGlycCc7XG5pbXBvcnQgeyB0ZW1wbGF0ZSBhcyBtYWtlVGVtcGxhdGUgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0ICogYXMgZW9sIGZyb20gJ2VvbCc7XG5pbXBvcnQgeyB0bXBEaXIsIHBhdGhGb3JEb21haW4gfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCBhcHBsaWNhdGlvbkNvbmZpZ1BhdGggPSByZXF1aXJlKCdhcHBsaWNhdGlvbi1jb25maWctcGF0aCcpO1xuaW1wb3J0ICogYXMgX2NyZWF0ZURlYnVnIGZyb20gJ2RlYnVnJztcblxuY29uc3QgZGVidWcgPSBfY3JlYXRlRGVidWcoJ2RldmNlcnQ6Y29uc3RhbnRzJyk7XG4vLyBQbGF0Zm9ybSBzaG9ydGN1dHNcbmV4cG9ydCBjb25zdCBpc01hYyA9IHByb2Nlc3MucGxhdGZvcm0gPT09ICdkYXJ3aW4nO1xuZXhwb3J0IGNvbnN0IGlzTGludXggPSBwcm9jZXNzLnBsYXRmb3JtID09PSAnbGludXgnO1xuZXhwb3J0IGNvbnN0IGlzV2luZG93cyA9IHByb2Nlc3MucGxhdGZvcm0gPT09ICd3aW4zMic7XG5cbi8vIENvbW1vbiBwYXRoc1xuZXhwb3J0IGNvbnN0IGNvbmZpZ0RpciA9IGFwcGxpY2F0aW9uQ29uZmlnUGF0aCgnZGV2Y2VydCcpO1xuZXhwb3J0IGNvbnN0IGNvbmZpZ1BhdGg6ICguLi5wYXRoU2VnbWVudHM6IHN0cmluZ1tdKSA9PiBzdHJpbmcgPSBwYXRoLmpvaW4uYmluZChcbiAgcGF0aCxcbiAgY29uZmlnRGlyXG4pO1xuXG5leHBvcnQgY29uc3QgZG9tYWluc0RpciA9IGNvbmZpZ1BhdGgoJ2RvbWFpbnMnKTtcblxuZXhwb3J0IGNvbnN0IGNhVmVyc2lvbkZpbGUgPSBjb25maWdQYXRoKCdkZXZjZXJ0LWNhLXZlcnNpb24nKTtcbmV4cG9ydCBjb25zdCBvcGVuc3NsU2VyaWFsRmlsZVBhdGggPSBjb25maWdQYXRoKFxuICAnY2VydGlmaWNhdGUtYXV0aG9yaXR5JyxcbiAgJ3NlcmlhbCdcbik7XG5leHBvcnQgY29uc3Qgb3BlbnNzbERhdGFiYXNlRmlsZVBhdGggPSBjb25maWdQYXRoKFxuICAnY2VydGlmaWNhdGUtYXV0aG9yaXR5JyxcbiAgJ2luZGV4LnR4dCdcbik7XG5leHBvcnQgY29uc3QgY2FTZWxmU2lnbkNvbmZpZyA9IHBhdGguam9pbihcbiAgX19kaXJuYW1lLFxuICAnLi4vb3BlbnNzbC1jb25maWd1cmF0aW9ucy9jZXJ0aWZpY2F0ZS1hdXRob3JpdHktc2VsZi1zaWduaW5nLmNvbmYnXG4pO1xuXG5mdW5jdGlvbiBpbmNsdWRlV2lsZGNhcmRzKGxpc3Q6IHN0cmluZ1tdKTogc3RyaW5nW10ge1xuICByZXR1cm4gbGlzdC5yZWR1Y2UoKG91dGxpc3QsIGl0ZW0pID0+IHtcbiAgICBvdXRsaXN0LnB1c2goaXRlbSwgYCouJHtpdGVtfWApO1xuICAgIHJldHVybiBvdXRsaXN0O1xuICB9LCBbXSBhcyBzdHJpbmdbXSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB3aXRoRG9tYWluU2lnbmluZ1JlcXVlc3RDb25maWcoXG4gIGNvbW1vbk5hbWU6IHN0cmluZyxcbiAgeyBhbHRlcm5hdGl2ZU5hbWVzIH06IHsgYWx0ZXJuYXRpdmVOYW1lczogc3RyaW5nW10gfSxcbiAgY2I6IChmaWxlcGF0aDogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+IHwgdm9pZFxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHRtcCA9IHRtcERpcigpO1xuICBjb25zdCB0bXBGaWxlID0gcGF0aC5qb2luKFxuICAgIHRtcC5uYW1lLFxuICAgICdkb21haW4tY2VydGlmaWNhdGUtc2lnbmluZy1yZXF1ZXN0cy5jb25mJ1xuICApO1xuICBjb25zdCBzb3VyY2UgPSByZWFkRmlsZShcbiAgICBwYXRoLmpvaW4oXG4gICAgICBfX2Rpcm5hbWUsXG4gICAgICAnLi4vb3BlbnNzbC1jb25maWd1cmF0aW9ucy9kb21haW4tY2VydGlmaWNhdGUtc2lnbmluZy1yZXF1ZXN0cy5jb25mJ1xuICAgICksXG4gICAgJ3V0Zi04J1xuICApO1xuICBjb25zdCB0ZW1wbGF0ZSA9IG1ha2VUZW1wbGF0ZShzb3VyY2UpO1xuICBjb25zdCByZXN1bHQgPSB0ZW1wbGF0ZSh7XG4gICAgY29tbW9uTmFtZSxcbiAgICBhbHROYW1lczogaW5jbHVkZVdpbGRjYXJkcyhbY29tbW9uTmFtZSwgLi4uYWx0ZXJuYXRpdmVOYW1lc10pXG4gIH0pO1xuICB3cml0ZUZpbGUodG1wRmlsZSwgZW9sLmF1dG8ocmVzdWx0KSk7XG4gIGF3YWl0IGNiKHRtcEZpbGUpO1xuICB1bmxpbmtTeW5jKHRtcEZpbGUpO1xuICB0bXAucmVtb3ZlQ2FsbGJhY2soKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHdpdGhEb21haW5DZXJ0aWZpY2F0ZUNvbmZpZyhcbiAgY29tbW9uTmFtZTogc3RyaW5nLFxuICBhbHRlcm5hdGl2ZU5hbWVzOiBzdHJpbmdbXSxcbiAgY2I6IChmaWxlcGF0aDogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+IHwgdm9pZFxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHRtcCA9IHRtcERpcigpO1xuICBjb25zdCB0bXBGaWxlID0gcGF0aC5qb2luKHRtcC5uYW1lLCAnY2EuY2ZnJyk7XG4gIGNvbnN0IHNvdXJjZSA9IHJlYWRGaWxlKFxuICAgIHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi9vcGVuc3NsLWNvbmZpZ3VyYXRpb25zL2RvbWFpbi1jZXJ0aWZpY2F0ZXMuY29uZicpLFxuICAgICd1dGYtOCdcbiAgKTtcbiAgY29uc3QgdGVtcGxhdGUgPSBtYWtlVGVtcGxhdGUoc291cmNlKTtcbiAgY29uc3QgcmVzdWx0ID0gdGVtcGxhdGUoe1xuICAgIGNvbW1vbk5hbWUsXG4gICAgYWx0TmFtZXM6IGluY2x1ZGVXaWxkY2FyZHMoW2NvbW1vbk5hbWUsIC4uLmFsdGVybmF0aXZlTmFtZXNdKSxcbiAgICBzZXJpYWxGaWxlOiBvcGVuc3NsU2VyaWFsRmlsZVBhdGgsXG4gICAgZGF0YWJhc2VGaWxlOiBvcGVuc3NsRGF0YWJhc2VGaWxlUGF0aCxcbiAgICBkb21haW5EaXI6IHBhdGhGb3JEb21haW4oY29tbW9uTmFtZSlcbiAgfSk7XG4gIHdyaXRlRmlsZSh0bXBGaWxlLCBlb2wuYXV0byhyZXN1bHQpKTtcbiAgYXdhaXQgY2IodG1wRmlsZSk7XG4gIHVubGlua1N5bmModG1wRmlsZSk7XG4gIHRtcC5yZW1vdmVDYWxsYmFjaygpO1xufVxuXG4vLyBjb25mVGVtcGxhdGUgPSBjb25mVGVtcGxhdGUucmVwbGFjZSgvREFUQUJBU0VfUEFUSC8sIGNvbmZpZ1BhdGgoJ2luZGV4LnR4dCcpLnJlcGxhY2UoL1xcXFwvZywgJ1xcXFxcXFxcJykpO1xuLy8gY29uZlRlbXBsYXRlID0gY29uZlRlbXBsYXRlLnJlcGxhY2UoL1NFUklBTF9QQVRILywgY29uZmlnUGF0aCgnc2VyaWFsJykucmVwbGFjZSgvXFxcXC9nLCAnXFxcXFxcXFwnKSk7XG4vLyBjb25mVGVtcGxhdGUgPSBlb2wuYXV0byhjb25mVGVtcGxhdGUpO1xuXG5leHBvcnQgY29uc3Qgcm9vdENBRGlyID0gY29uZmlnUGF0aCgnY2VydGlmaWNhdGUtYXV0aG9yaXR5Jyk7XG5leHBvcnQgY29uc3Qgcm9vdENBS2V5UGF0aCA9IHBhdGguam9pbihyb290Q0FEaXIsICdwcml2YXRlLWtleS5rZXknKTtcbmV4cG9ydCBjb25zdCByb290Q0FDZXJ0UGF0aCA9IHBhdGguam9pbihyb290Q0FEaXIsICdjZXJ0aWZpY2F0ZS5jZXJ0Jyk7XG5cbmRlYnVnKCdyb290Q0FDZXJ0UGF0aCcsIHJvb3RDQUNlcnRQYXRoKTtcbmRlYnVnKCdyb290Q0FLZXlQYXRoJywgcm9vdENBS2V5UGF0aCk7XG5kZWJ1Zygncm9vdENBRGlyJywgcm9vdENBRGlyKTtcblxuLy8gRXhwb3NlZCBmb3IgdW5pbnN0YWxsYXRpb24gcHVycG9zZXMuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TGVnYWN5Q29uZmlnRGlyKCk6IHN0cmluZyB7XG4gIGlmIChpc1dpbmRvd3MgJiYgcHJvY2Vzcy5lbnYuTE9DQUxBUFBEQVRBKSB7XG4gICAgcmV0dXJuIHBhdGguam9pbihwcm9jZXNzLmVudi5MT0NBTEFQUERBVEEsICdkZXZjZXJ0JywgJ2NvbmZpZycpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHVpZCA9IHByb2Nlc3MuZ2V0dWlkICYmIHByb2Nlc3MuZ2V0dWlkKCk7XG4gICAgY29uc3QgdXNlckhvbWUgPVxuICAgICAgaXNMaW51eCAmJiB1aWQgPT09IDBcbiAgICAgICAgPyBwYXRoLnJlc29sdmUoJy91c3IvbG9jYWwvc2hhcmUnKVxuICAgICAgICA6IHJlcXVpcmUoJ29zJykuaG9tZWRpcigpO1xuICAgIHJldHVybiBwYXRoLmpvaW4odXNlckhvbWUsICcuY29uZmlnJywgJ2RldmNlcnQnKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZW5zdXJlQ29uZmlnRGlycygpOiB2b2lkIHtcbiAgbWtkaXJwKGNvbmZpZ0Rpcik7XG4gIG1rZGlycChkb21haW5zRGlyKTtcbiAgbWtkaXJwKHJvb3RDQURpcik7XG59XG5cbmVuc3VyZUNvbmZpZ0RpcnMoKTtcbiJdfQ==